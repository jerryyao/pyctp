# 1.简介 #

pyctp将配置分为服务器连接配置和策略配置两个文件，同时用指定的state.ini文件来保存执行状态；


# 2.服务器连接配置 #

默认文件名为base.ini, 但可在执行函数中指定名称，如demo\_base.ini；

## 2.1 文件格式 ##

### 2.1.1 基础配置块 ###

> 默认块名为Base, 用于设定行情连接和交易连接名，其中行情连接可设定多个；

> 键为
```
   users:设定行情连接
   trades:设定交易链接
```

### 2.1.2 行情配置块 ###
> 逐一配置基础配置块中指定的行情连接；

> 键包括
```
  port: 端口
  broker_id: 服务提供商ID
  investor_id: 行情用户ID，行情不需设定用户名,通常用*取代
  passwd: 行情用户口令，不需要，可用*取代
```

  * 目前investor\_id和passwd都以明文保存在配置文件中，不够安全；须至少以简单可逆方式处理下，避免被托管服务器提供商轻易获取；

### 2.1.3 交易配置块 ###
> 键同交易配置块，但是必须设定investor\_id和passwd, 才能够链接到相应的交易服务器或模拟服务器；


# 3.策略配置 #
目前分别简单实现了行情记录和交易策略设定；

## 3.1 行情记录配置 ##
仅提供了非常简陋的实现，须直接在 **Trace\_Instruments\_Raw** 节下指定要记录的合约；

### 3.1.1 Trace\_Instruments\_Raw配置 ###
其下键为各合约种类，可任意添加键，并将具体合约设定为相应值；
如
```
IFs = IF1209,IF1212
```

### 3.1.2 TODO: ###
合理的行情记录方式是挨个枚举各交易所的现有合约，然后记录之；这里的矛盾是合约查询属于交易链接的功能；

或者也可以根据各类合约的命名规则和当前日期，计算应当出现的合约；

因为目前我自己只操作IF，没这方面的需求，所以也不打算在这上面化更多时间；

## 3.2 交易策略配置 ##
这里的设定有点诡异，当时可能想的有点复杂了，后面虽然实际上只用到了部分，但也懒得改了；

### 3.2.1 Trace\_Instruments ###
这节貌似没用到

### Trace\_Instruments\_Raw ###
定义盯盘列表，后面要设定交易策略的合约，必须出现在盯盘列表中；

设定方式同行情记录配置的同一条目；

这个设定现在看起来有点没意义。最初是想把行情记录和交易程序配置合二为一，才有这样的设定；现在的倾向是把两个策略文件分开来，两个程序各自独立运行；

### Trade\_Config ###
设定本地的策略文件和交易策略组别名；

```
strategy_file: 指定保存本地策略的文件名，通常在my包下；
traces: 指定交易策略组别名
```

### Alias\_Def ###
设定交易策略组别名对应的合约名；键为Trade\_Config下traces中的每个别名；需要为每个别名指定具体操作的合约名；

所指定的合约名必须在Trace\_Instruments\_Raw节下的盯盘合约列表中；

这个设定现在看起来有点脱裤子放X，

### 策略组定义 ###
针对Trade\_Config下的每个策略组别名，需定义具体的策略信息；

```
max_volume: 该策略组同时开仓最大手数；程序根据这个设定和资金量计算实际开仓手数；
max_vtimes: 当日累计开仓手数
max_lost: 当日最大损失，超过该损失后将不再开仓；
strategys: 开仓策略设定，可设定多个；
```

现在已经略过了max\_lost的处理；

### 策略定义 ###
针对策略组定义中strategys下的每个策略，需进一步定义；

```
max_holding: 该策略最大持仓量；
open_volume: 该策略最大开仓手数；若max_holding>open_volume,则可能多次开仓；
opener: 开仓策略
closers = 平仓策略，可设定多个；通常一个为时间止损；
```


# 4 状态文件 #
> 用于临时保存开仓状态，记录了开仓手数、止损函数、初始止损、跟踪止损等必要信息，以备系统崩溃并重新启动后能继续跟进；

> 具体细节可参见config文件中的相应函数；

# 5 实盘执行 #
> 为保证鲁棒性和连续性，建议实盘时，同时开启行情记录Agent和交易Agent两路程序。这样，交易Agent崩溃后，能从行情记录Agent的历史行情中取回相应数据，并据此持续运作；